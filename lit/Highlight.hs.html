<!DOCTYPE HTML>
<html><head><title>Highlight.hs</title><meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../css/default.css"></head><body><h1><a href="root.html">/ </a>Highlight.hs - highlights generated Html</h1>
<p>Highlight is a tampered version of John MacFarlane's <a href="https://github.com/jgm/highlighting-kate">highlighting-kate</a> library. It exposes some of the internals to allow for custom highlighting. The highlighting simply lexes and applies token wrappers around atoms. For example:</p>
<p><code>&quot;import&quot; -&gt; (KeywordTok, &quot;import&quot;)</code></p>
<p>After being rendered to Html the previous tokenized atom is represented as:</p>
<p><code>&lt;span class=&quot;kw&quot;&gt;import&lt;/span&gt;</code></p>
<p>An overview of the file:</p>
<pre><code>&lt;&lt; <a id="*" href="#*">*</a> &gt;&gt;=
&lt;&lt; <a href="#define_Highlight_module">define Highlight module</a> &gt;&gt;
&lt;&lt; <a href="#import_modules">import modules</a> &gt;&gt;
&lt;&lt; <a href="#highlight_text_by_language">highlight text by language</a> &gt;&gt;
&lt;&lt; <a href="#transform_tokenized_line_to_html">transform tokenized line to html</a> &gt;&gt;
&lt;&lt; <a href="#transform_token_to_html">transform token to html</a> &gt;&gt;
&lt;&lt; <a href="#token_to_class_name">token to class name</a> &gt;&gt;
&lt;&lt; <a href="#lookup_language_by_file_extension">lookup language by file extension</a> &gt;&gt;
</code></pre><p>Highlight exports <code>highlight</code> to tokenize html, and <code>getLang</code> which uses a lookup to return the language for a given file extension.</p>
<pre><code>&lt;&lt; <a id="define_Highlight_module" href="#define_Highlight_module">define Highlight module</a> &gt;&gt;=
<span class="kw">module</span> <span class="dt">Highlight</span> (highlight, getLang) <span class="kw">where</span>
</code></pre><p>Highlight does not depend on any modules local to <code>lit</code>. It really repackages the functionality from <a href="https://github.com/jgm/highlighting-kate">highlighting-kate</a>.</p>
<pre><code>&lt;&lt; <a id="import_modules" href="#import_modules">import modules</a> &gt;&gt;=
<span class="kw">import qualified</span> <span class="dt">Data.Text</span> <span class="kw">as</span> <span class="dt">T</span> 
<span class="kw">import </span><span class="dt">Data.Monoid</span> (mconcat)

<span class="kw">import </span><span class="dt">Text.Blaze</span> (toValue, (!))
<span class="kw">import qualified</span> <span class="dt">Text.Blaze.Html5</span> <span class="kw">as</span> <span class="dt">H</span>
<span class="kw">import qualified</span> <span class="dt">Text.Blaze.Html5.Attributes</span> <span class="kw">as</span> <span class="dt">A</span>
<span class="kw">import </span><span class="dt">Text.Highlighting.Kate</span> ( defaultFormatOpts
                              , highlightAs
                              , languagesByFilename )
<span class="kw">import </span><span class="dt">Text.Highlighting.Kate.Types</span> 
</code></pre><p><code>highlight</code> transforms text into Html that can be stylized with Css. This is accomplished by tokenizing the text into type <code>SourceLine</code> an alias for a list of tokens which are converted to Html.</p>
<pre><code>&lt;&lt; <a id="highlight_text_by_language" href="#highlight_text_by_language">highlight text by language</a> &gt;&gt;=
<span class="ot">highlight ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">T.Text</span> <span class="ot">-&gt;</span> <span class="dt">H.Html</span>
highlight lang txt <span class="fu">=</span> 
    <span class="kw">let</span>
        highlighted <span class="fu">=</span> highlightAs lang (T.unpack txt)
        htmlList <span class="fu">=</span> map sourceLineToHtml highlighted
    <span class="kw">in</span> 
        mconcat htmlList
</code></pre><p>This helper function transforms a list of tokens into Html.</p>
<pre><code>&lt;&lt; <a id="transform_tokenized_line_to_html" href="#transform_tokenized_line_to_html">transform tokenized line to html</a> &gt;&gt;=
<span class="ot">sourceLineToHtml ::</span> <span class="dt">SourceLine</span> <span class="ot">-&gt;</span> <span class="dt">H.Html</span>
sourceLineToHtml line <span class="fu">=</span> mconcat <span class="fu">$</span>  htmlList <span class="fu">++</span> [H.toHtml <span class="st">&quot;\n&quot;</span>]
    <span class="kw">where</span>
        htmlList <span class="fu">=</span> map (tokenToHtml defaultFormatOpts) line
</code></pre><p>This helper function transforms a single token into Html.</p>
<pre><code>&lt;&lt; <a id="transform_token_to_html" href="#transform_token_to_html">transform token to html</a> &gt;&gt;=
<span class="ot">tokenToHtml ::</span> <span class="dt">FormatOptions</span> <span class="ot">-&gt;</span> <span class="dt">Token</span> <span class="ot">-&gt;</span> <span class="dt">H.Html</span>
tokenToHtml _ (<span class="dt">NormalTok</span>, str)  <span class="fu">=</span> H.toHtml str
tokenToHtml opts (toktype, str) <span class="fu">=</span>
    <span class="kw">if</span> titleAttributes opts
    <span class="kw">then</span> sp <span class="fu">!</span> A.title (toValue <span class="fu">$</span> show toktype)
    <span class="kw">else</span> sp 
        <span class="kw">where</span> sp <span class="fu">=</span> H.span <span class="fu">!</span> A.class_ (toValue <span class="fu">$</span> short toktype) <span class="fu">$</span> H.toHtml str
</code></pre><p>When a <code>TokenType</code> is transformed to Html the <code>short</code> function provides the Html class attribute value.</p>
<pre><code>&lt;&lt; <a id="token_to_class_name" href="#token_to_class_name">token to class name</a> &gt;&gt;=
<span class="ot">short ::</span> <span class="dt">TokenType</span> <span class="ot">-&gt;</span> <span class="dt">String</span>
short <span class="dt">KeywordTok</span>        <span class="fu">=</span> <span class="st">&quot;kw&quot;</span>
short <span class="dt">DataTypeTok</span>       <span class="fu">=</span> <span class="st">&quot;dt&quot;</span>
short <span class="dt">DecValTok</span>         <span class="fu">=</span> <span class="st">&quot;dv&quot;</span>
short <span class="dt">BaseNTok</span>          <span class="fu">=</span> <span class="st">&quot;bn&quot;</span>
short <span class="dt">FloatTok</span>          <span class="fu">=</span> <span class="st">&quot;fl&quot;</span>
short <span class="dt">CharTok</span>           <span class="fu">=</span> <span class="st">&quot;ch&quot;</span>
short <span class="dt">StringTok</span>         <span class="fu">=</span> <span class="st">&quot;st&quot;</span>
short <span class="dt">CommentTok</span>        <span class="fu">=</span> <span class="st">&quot;co&quot;</span>
short <span class="dt">OtherTok</span>          <span class="fu">=</span> <span class="st">&quot;ot&quot;</span>
short <span class="dt">AlertTok</span>          <span class="fu">=</span> <span class="st">&quot;al&quot;</span>
short <span class="dt">FunctionTok</span>       <span class="fu">=</span> <span class="st">&quot;fu&quot;</span>
short <span class="dt">RegionMarkerTok</span>   <span class="fu">=</span> <span class="st">&quot;re&quot;</span>
short <span class="dt">ErrorTok</span>          <span class="fu">=</span> <span class="st">&quot;er&quot;</span>
short <span class="dt">NormalTok</span>         <span class="fu">=</span> <span class="st">&quot;&quot;</span>
</code></pre><p>A utility exported by Highlight which provides the language for a given file path.</p>
<pre><code>&lt;&lt; <a id="lookup_language_by_file_extension" href="#lookup_language_by_file_extension">lookup language by file extension</a> &gt;&gt;=
getLang path <span class="fu">=</span> 
    <span class="kw">case</span> languagesByFilename path <span class="kw">of</span>
    [] <span class="ot">-&gt;</span> <span class="st">&quot;&quot;</span>
    lst <span class="ot">-&gt;</span> head lst
</code></pre></body></html>
<!DOCTYPE HTML>
<html><head><title>Markdown.hs</title><meta charset="UTF-8"><link rel="stylesheet" type="text/css" href="../css/default.css"></head><body><h1><a href="root.html">/ </a>Markdown.hs - generates markdown from a <code>lit</code> file</h1>
<p>Markdown is a module which transforms the main data structure for a parsed
<code>lit</code> file into markdown. The main motivation for markdown as a supported
document is to enable users to render <code>lit</code> files with existing <code>Markdown</code> engines.
Most notably, converted <code>lit</code> files can be automatically viewed on Github. Although
<code>lit</code> files can be functional markdown, this module labels code blocks by
language and allows the original <code>lit</code> file to use a preferred indentation.
Markdown primarily transforms code blocks.</p>
<p>An overview of the file:</p>
<pre><code>&lt;&lt; <a id="*" href="#*">*</a> &gt;&gt;=
&lt;&lt; <a href="#define_html_module">define html module</a> &gt;&gt;
&lt;&lt; <a href="#import_modules">import modules</a> &gt;&gt;
&lt;&lt; <a href="#generate_markdown_document_from_chunks">generate markdown document from chunks</a> &gt;&gt;
&lt;&lt; <a href="#helper_functions">helper functions</a> &gt;&gt;
</code></pre><p>Markdown only exports <code>generate</code> akin to Code and Html, the other output modules.</p>
<pre><code>&lt;&lt; <a id="define_html_module" href="#define_html_module">define html module</a> &gt;&gt;=
<span class="ot">{-# LANGUAGE OverloadedStrings #-}</span>
<span class="kw">module</span> <span class="dt">Markdown</span> ( generate ) <span class="kw">where</span>
</code></pre><p>Markdown performs little processing and as a result has light dependencies.
In Markdown, <code>getLang</code> is used to to label code blocks with a language.</p>
<pre><code>&lt;&lt; <a id="import_modules" href="#import_modules">import modules</a> &gt;&gt;=
<span class="kw">import qualified</span> <span class="dt">Data.Text</span> <span class="kw">as</span> <span class="dt">T</span>

<span class="kw">import </span><span class="dt">Types</span>
<span class="kw">import </span><span class="dt">Highlight</span> (getLang)
</code></pre><p><code>generate</code> is the interface for the module. <code>lit</code> generates the <code>[Chunk]</code> with Parse.hs
before calling <code>generate</code> to make the markdown file from a <code>lit</code> file. <code>generate</code> returns
the union of all the transformed markdown <code>Chunk</code>s.</p>
<pre><code>&lt;&lt; <a id="generate_markdown_document_from_chunks" href="#generate_markdown_document_from_chunks">generate markdown document from chunks</a> &gt;&gt;=
<span class="ot">generate ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> [<span class="dt">Chunk</span>] <span class="ot">-&gt;</span> <span class="dt">T.Text</span>
generate name chunks <span class="fu">=</span> 
    <span class="kw">let</span> 
        lang <span class="fu">=</span> getLang name
        toMarkDown <span class="fu">=</span> chunkToMarkdown lang
    <span class="kw">in</span>
        T.concat <span class="fu">$</span> map toMarkDown chunks
</code></pre><p>An overview of the helper functions used to generate a markdown document.</p>
<pre><code>&lt;&lt; <a id="helper_functions" href="#helper_functions">helper functions</a> &gt;&gt;=
&lt;&lt; <a href="#frequently_used_operator_for_appending_text">frequently used operator for appending text</a> &gt;&gt;
&lt;&lt; <a href="#transorm_a_chunk_to_markdown">transorm a chunk to markdown</a> &gt;&gt;
&lt;&lt; <a href="#transform_a_part_of_a_chunk_to_markdown">transform a part of a chunk to markdown</a> &gt;&gt;
</code></pre><p>Due to the verbosity of using <code>T.append</code> as an infix operator for <code>T.Text</code>, the following
operator appends text like the list append operator <code>++</code></p>
<pre><code>&lt;&lt; <a id="frequently_used_operator_for_appending_text" href="#frequently_used_operator_for_appending_text">frequently used operator for appending text</a> &gt;&gt;=
<span class="ot">(&lt;++&gt;) ::</span> <span class="dt">T.Text</span> <span class="ot">-&gt;</span> <span class="dt">T.Text</span> <span class="ot">-&gt;</span> <span class="dt">T.Text</span>
(<span class="fu">&lt;++&gt;</span>) <span class="fu">=</span> T.append
</code></pre><p><code>chunkToMarkdown</code> only processes code portions, since <code>Prose</code> is already assumed to be
markdown. Code blocks are wrapped in triple backticks and labeled with the inferred
language of the code from the file extension.</p>
<pre><code>&lt;&lt; <a id="transorm_a_chunk_to_markdown" href="#transorm_a_chunk_to_markdown">transorm a chunk to markdown</a> &gt;&gt;=
chunkToMarkdown lang chunk <span class="fu">=</span>
    <span class="kw">case</span> chunk <span class="kw">of</span>
    <span class="dt">Prose</span> text  <span class="ot">-&gt;</span> text
    <span class="dt">Def</span> _ name parts <span class="ot">-&gt;</span> 
        <span class="kw">let</span> 
            lang&#39; <span class="fu">=</span> T.pack lang
            header <span class="fu">=</span> <span class="st">&quot;&lt;&lt; &quot;</span> <span class="fu">&lt;++&gt;</span> (T.strip name) <span class="fu">&lt;++&gt;</span> <span class="st">&quot; &gt;&gt;=&quot;</span>
            mdParts <span class="fu">=</span> T.concat <span class="fu">$</span> map (partToText lang) parts
        <span class="kw">in</span> 
            <span class="st">&quot;```&quot;</span> <span class="fu">&lt;++&gt;</span> lang&#39;   <span class="fu">&lt;++&gt;</span> 
            <span class="st">&quot;\n&quot;</span>  <span class="fu">&lt;++&gt;</span> header  <span class="fu">&lt;++&gt;</span> 
            <span class="st">&quot;\n&quot;</span>  <span class="fu">&lt;++&gt;</span> mdParts <span class="fu">&lt;++&gt;</span> <span class="st">&quot;```\n&quot;</span>
</code></pre><p>A <code>Chunk</code> contains a <code>[Part]</code> where each <code>Part</code> is either
a line of code or a macro reference. In this module a <code>[Part]</code>
is rendered as a code block. Each line of code is valid, but
each reference needs to be classified as a macro, with the
macro syntax <code>&lt;&lt; ... &gt;&gt;</code>.</p>
<pre><code>&lt;&lt; <a id="transform_a_part_of_a_chunk_to_markdown" href="#transform_a_part_of_a_chunk_to_markdown">transform a part of a chunk to markdown</a> &gt;&gt;=
<span class="ot">partToText ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Part</span> <span class="ot">-&gt;</span> <span class="dt">T.Text</span>
partToText lang part <span class="fu">=</span>
    <span class="kw">case</span> part <span class="kw">of</span>
    <span class="dt">Code</span> txt <span class="ot">-&gt;</span> txt
    <span class="dt">Ref</span> txt indent <span class="ot">-&gt;</span> (indent <span class="fu">&lt;++&gt;</span> <span class="st">&quot;&lt;&lt; &quot;</span> <span class="fu">&lt;++&gt;</span> (T.strip txt) <span class="fu">&lt;++&gt;</span> <span class="st">&quot; &gt;&gt;\n&quot;</span>)
</code></pre></body></html>